{
  "action_id": "marketplace/julia-actions/julia-invalidations",
  "version_id": "add8a3257d93",
  "source": {
    "type": "marketplace",
    "action_yml_path": "blueprints/marketplace/julia-actions/julia-invalidations/action.yml",
    "origin": "github.com/julia-actions/julia-invalidations",
    "publisher": "julia-actions",
    "verified": false,
    "latest_release": {
      "tag_name": "v1.1",
      "name": "v1.1",
      "published_at": "2024-11-24T15:20:49Z",
      "html_url": "https://github.com/julia-actions/julia-invalidations/releases/tag/v1.1",
      "prerelease": false,
      "draft": false
    }
  },
  "definition": {
    "name": "Invalidations",
    "description": "Evaluate number of invalidations",
    "author": "",
    "inputs": [
      {
        "name": "test_script",
        "required": false,
        "default": "",
        "description": "Script to test for invalidations. Defaults to `import Package`"
      },
      {
        "name": "package_name",
        "required": false,
        "default": "",
        "description": "Name of the package. By default, tries to auto-detect from the repo name."
      },
      {
        "name": "max_invalidations",
        "required": false,
        "default": "0",
        "description": "Maximum number of invalidations to report. Defaults to `0` (no limit)"
      }
    ],
    "outputs": [
      {
        "name": "total",
        "description": "Total number of invalidations"
      },
      {
        "name": "deps",
        "description": "Number of invalidations caused by deps"
      }
    ],
    "runs": {
      "using": "composite",
      "steps": [
        {
          "name": "Get package name",
          "id": "info",
          "run": "REPONAME=\"${{ github.event.repository.name }}\"\nif [[ '${{ inputs.package_name }}' == '' ]]; then\n  PACKAGENAME=${REPONAME%.jl}\nelse\n  PACKAGENAME=\"${{ inputs.package_name }}\"\nfi\necho \"packagename=$PACKAGENAME\" >> $GITHUB_OUTPUT\nif [[ '${{ inputs.test_script }}' == '' ]]; then\n  TESTSCRIPT=\"import ${PACKAGENAME}\"\nelse\n  TESTSCRIPT=\"${{ inputs.test_script }}\"\nfi\necho \"testscript=$TESTSCRIPT\" >> $GITHUB_OUTPUT\n",
          "shell": "bash"
        },
        {
          "name": "Install SnoopCompile tools",
          "run": "import Pkg;\npkgs = [\n    Pkg.PackageSpec(name = \"SnoopCompile\", version = \"3\", uuid = \"aa65fe97-06da-5843-b5b1-d5d13cad87d2\"),\n    Pkg.PackageSpec(name = \"SnoopCompileCore\", uuid = \"e2b509da-e806-4183-be48-004708413034\"),\n    Pkg.PackageSpec(name = \"PrettyTables\", uuid = \"08abe8d2-0d0c-5749-adfa-8a2ac140af0d\"),\n]\nPkg.add(pkgs)\n",
          "shell": "julia --project {0}"
        },
        {
          "name": "Load package on branch",
          "id": "invs",
          "run": "using SnoopCompileCore: @snoop_invalidations\ninvalidations = @snoop_invalidations begin ${{ steps.info.outputs.testscript }} end\n\nusing SnoopCompile: SnoopCompile, filtermod, invalidation_trees, uinvalidated\ninv_owned = length(filtermod(${{ steps.info.outputs.packagename }}, invalidation_trees(invalidations)))\ninv_total = length(uinvalidated(invalidations))\ninv_deps = inv_total - inv_owned\n\n@show inv_total, inv_deps\n\n# Report invalidations summary:\nimport PrettyTables  # needed for `report_invalidations` to be defined\nSnoopCompile.report_invalidations(;\n     invalidations,\n     process_filename = x -> last(split(x, \".julia/packages/\")),\n     n_rows = ${{ inputs.max_invalidations }},\n)\n\n# Set outputs\nusing Printf\nopen(ENV[\"GITHUB_OUTPUT\"], \"a\") do io\n  println(io, @sprintf(\"total=%09d\", inv_total))\n  println(io, @sprintf(\"deps=%09d\", inv_deps))\nend\n",
          "shell": "julia --color=yes --project=. {0}"
        }
      ]
    }
  },
  "annotations": {
    "categories": [],
    "confidence": null,
    "evidence": []
  },
  "cache": {
    "source_hash": "add8a3257d938b032fa92f99ea336b50afdc634c2bce4e305163f0891e522dd3",
    "taxonomy_version": "0.0.1",
    "prompt_version": "v1",
    "generated_at": "2025-12-15T05:22:26.622333Z"
  }
}
