{
  "action_id": "marketplace/azure/run-sqlpackage-action",
  "version_id": "d14f224c455d",
  "source": {
    "type": "marketplace",
    "action_yml_path": "blueprints/marketplace/azure/run-sqlpackage-action/action.yml",
    "origin": "github.com/azure/run-sqlpackage-action",
    "publisher": "azure",
    "verified": true
  },
  "definition": {
    "name": "run-sqlpackage",
    "description": "Runs SqlPackage command on a target database",
    "author": "",
    "inputs": [
      {
        "name": "action",
        "required": true,
        "default": null,
        "description": "Action parameter to run with SqlPackage. Supported values are: Publish, DeployReport, DriftReport, Script"
      },
      {
        "name": "sourcepath",
        "required": true,
        "default": null,
        "description": "The path where to look for the DACPAC file. If multiple files exists, all of them are processed"
      },
      {
        "name": "profile",
        "required": true,
        "default": null,
        "description": "The profile path to use during the execution. It has to be an xml file"
      },
      {
        "name": "database-server",
        "required": false,
        "default": "",
        "description": "Database server URL (without protocol). If not indicated in the publishing profile, it has to be indicated here."
      },
      {
        "name": "database-name",
        "required": false,
        "default": "",
        "description": "Database name. If not indicated in the publishing profile, it has to be indicated here."
      },
      {
        "name": "authtoken",
        "required": false,
        "default": "",
        "description": "The authentication token used to connect to the database, if credentials not indicated in the connection string"
      },
      {
        "name": "outputpath",
        "required": false,
        "default": ".",
        "description": "The output folder where assets will be generated if any"
      },
      {
        "name": "outputfile",
        "required": false,
        "default": "deployreport.xml",
        "description": "The output file name. The final name of the file will be [dacpac_name].[outputfile]"
      }
    ],
    "outputs": [],
    "runs": {
      "using": "composite",
      "steps": [
        {
          "name": "Installing SQL Data Tools",
          "shell": "bash",
          "run": "if test -f \"/opt/sqlpackage/sqlpackage\"; then\n  echo \"::debug::SqlPackage already installed in the context\"\nelse\n  sudo apt-get install libunwind8\n  wget -progress=bar:force -q -O sqlpackage.zip \\\n    https://aka.ms/sqlpackage-linux \\\n    && unzip -qq sqlpackage.zip -d /opt/sqlpackage \\\n    && chmod a+x /opt/sqlpackage/sqlpackage \\\n    && rm sqlpackage.zip\nfi\n"
        },
        {
          "id": "sqlpackage",
          "name": "Running SqlPackage tool",
          "shell": "bash",
          "run": "echo \"::debug::Ensuring target folder '${{ inputs.outputpath }}'\"\nmkdir -p ${{ inputs.outputpath }}\n\necho \"::debug::Looking for dacpac files at '${{ inputs.sourcepath }}'\"\nPACKAGE_PATHS=$(find ${{ inputs.sourcepath }} -name '*.dacpac' -exec basename {} \\;)\n\nfor PACKAGE in $PACKAGE_PATHS\ndo\n  echo \"::debug::Runing ${{ inputs.action }} on package $PACKAGE\"\n  SQLPACKAGE_CMD=\"/opt/sqlpackage/sqlpackage \\\n      /Action:${{ inputs.action }} \\\n      /SourceFile:${{ inputs.sourcepath }}/$PACKAGE \\\n      /Profile:${{ inputs.profile }}\"\n  \n  if [[ '${{ inputs.database-server }}' != '' ]]; then\n    SQLPACKAGE_CMD=\"$SQLPACKAGE_CMD \\\n      /TargetServerName:${{ inputs.database-server }}\"\n  fi\n\n  if [[ '${{ inputs.database-name }}' != '' ]]; then\n    SQLPACKAGE_CMD=\"$SQLPACKAGE_CMD \\\n      /TargetDatabaseName:${{ inputs.database-name }}\"\n  fi\n\n  if [[ '${{ inputs.authtoken }}' != '' ]]; then\n    SQLPACKAGE_CMD=\"$SQLPACKAGE_CMD \\\n      /AccessToken:${{ inputs.authtoken }}\"\n  fi\n\n  if [[ '${{ inputs.action }}' != 'Publish' ]]; then\n    PACKAGE_NAME=\"${PACKAGE%.*}\"\n    SQLPACKAGE_CMD=\"$SQLPACKAGE_CMD \\\n      /OutputPath:${{ inputs.outputpath }}/$PACKAGE_NAME.${{ inputs.outputfile }} \\\n      /OverwriteFiles:True\"\n  fi\n\n  echo \"::debug::SqlPackage intruction is '$SQLPACKAGE_CMD'\"\n  eval $SQLPACKAGE_CMD\ndone\n"
        }
      ]
    }
  },
  "annotations": {
    "categories": [],
    "confidence": null,
    "evidence": []
  },
  "cache": {
    "source_hash": "d14f224c455ddaa1994ea1fc5dc2a2fecb0b081bf2b70b568091478df2d950df",
    "taxonomy_version": "0.0.1",
    "prompt_version": "v1",
    "generated_at": "2025-12-15T05:21:59.604499Z"
  }
}
